# LAB 17.10 - Du≈ºe obiekty binarne (BLOB)

## Zadanie 1
```sql
CREATE TABLE MOVIES AS SELECT * FROM ZTPD.MOVIES;
```

## Zadanie 2
```sql
DESCRIBE MOVIES;
```

## Zadanie 3
```sql
SELECT ID, TITLE FROM MOVIES WHERE COVER IS NULL;
```

## Zadanie 4
```sql
SELECT ID, TITLE, DBMS_LOB.GETLENGTH(COVER) AS FILESIZE
FROM MOVIES
WHERE COVER IS NOT NULL;
```

## Zadanie 5
```sql
SELECT ID, TITLE, DBMS_LOB.GETLENGTH(COVER) AS FILESIZE
FROM MOVIES
WHERE COVER IS NULL;
```

## Zadanie 6
```sql
SELECT * FROM ALL_DIRECTORIES;
```

## Zadanie 7
```sql
UPDATE MOVIES
SET COVER = EMPTY_BLOB(),
    MIME_TYPE = 'image/jpeg'
WHERE ID = 66;

COMMIT;
```

## Zadanie 8
```sql
SELECT ID, TITLE, DBMS_LOB.GETLENGTH(COVER) AS FILESIZE
FROM MOVIES
WHERE ID IN (65, 66);
```

## Zadanie 9
```sql
DECLARE
    CVR BLOB;
    FILS BFILE := BFILENAME('TPD_DIR','escape.jpg');
BEGIN
    SELECT COVER INTO CVR FROM MOVIES WHERE ID = 66 FOR UPDATE;
    DBMS_LOB.FILEOPEN(FILS, DBMS_LOB.FILE_READONLY);
    DBMS_LOB.LOADFROMFILE(CVR, FILS, DBMS_LOB.GETLENGTH(FILS)); 
    DBMS_LOB.FILECLOSE(FILS); 
    COMMIT;
END;
```

## Zadanie 10
```sql
CREATE TABLE TEMP_COVERS (
    MOVIE_ID NUMBER(12),
    IMAGE BFILE,
    MIME_TYPE VARCHAR2(50)
);
```

## Zadanie 11
```sql
INSERT INTO TEMP_COVERS (MOVIE_ID, IMAGE, MIME_TYPE) 
VALUES (65, BFILENAME('TPD_DIR','eagles.jpg'), 'image/jpeg');

COMMIT;
```

## Zadanie 12
```sql
SELECT MOVIE_ID, DBMS_LOB.GETLENGTH(IMAGE) AS FILESIZE
FROM TEMP_COVERS
WHERE MOVIE_ID = 65;
```

## Zadanie 13
```sql
DECLARE
    CVR BLOB;
    FILS BFILE;
    CVR_MIME_TYPE VARCHAR2(50);
BEGIN
    SELECT IMAGE, MIME_TYPE INTO FILS, CVR_MIME_TYPE
    FROM TEMP_COVERS WHERE MOVIE_ID = 65;

    DBMS_LOB.CREATETEMPORARY(CVR, TRUE); 

    DBMS_LOB.FILEOPEN(FILS, DBMS_LOB.FILE_READONLY);
    DBMS_LOB.LOADFROMFILE(CVR, FILS, DBMS_LOB.GETLENGTH(FILS)); 
    DBMS_LOB.FILECLOSE(FILS); 
    
    UPDATE MOVIES SET COVER = CVR, MIME_TYPE = CVR_MIME_TYPE WHERE ID = 65;
    
    DBMS_LOB.FREETEMPORARY(CVR); 

    COMMIT;
END;
```

## Zadanie 14
```sql
SELECT ID, TITLE, DBMS_LOB.GETLENGTH(COVER) AS FILESIZE
FROM MOVIES
WHERE ID IN (65, 66);
```

## Zadanie 15
```sql
DROP TABLE MOVIES;
DROP TABLE TEMP_COVERS;
```