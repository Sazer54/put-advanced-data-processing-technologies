# LAB 21.11 - Oracle Spatial: Standard SQL/MM

1A.

select lpad('-',2*(level-1),'|-') || t.owner||'.'||t.type_name||' (FINAL:'||t.final|| 
', INSTANTIABLE:'||t.instantiable||', ATTRIBUTES:'||t.attributes||', METHODS:'||t.methods||')' 
from   all_types t 
start with t.type_name = 'ST_GEOMETRY' 
connect by prior t.type_name = t.supertype_name  
and prior t.owner = t.owner; 

1B.

select distinct m.method_name 
from   all_type_methods m 
where  m.type_name like 'ST_POLYGON' 
and    m.owner = 'MDSYS' 
order by 1;

1C.
CREATE TABLE MYST_MAJOR_CITIES (
    FIPS_CNTRY VARCHAR2(2),
    CITY_NAME VARCHAR2(40),
    STGEOM ST_POINT
);

1D.
INSERT INTO MYST_MAJOR_CITIES
SELECT FIPS_CNTRY, CITY_NAME, 
       TREAT(ST_POINT.FROM_SDO_GEOM(GEOM) AS ST_POINT)
FROM MAJOR_CITIES;

2.
INSERT INTO MYST_MAJOR_CITIES 
VALUES ('PL', 'Szczyrk', ST_POINT(19.036107, 49.718655, 8307));

3A.
CREATE TABLE MYST_COUNTRY_BOUNDARIES (
    FIPS_CNTRY VARCHAR2(2),
    CNTRY_NAME VARCHAR2(40),
    STGEOM ST_MULTIPOLYGON
);

3B.
INSERT INTO MYST_COUNTRY_BOUNDARIES
SELECT FIPS_CNTRY, CNTRY_NAME, ST_MULTIPOLYGON(GEOM)
FROM COUNTRY_BOUNDARIES;

3C.
SELECT b.STGEOM.ST_GEOMETRYTYPE() AS TYP, COUNT(*)
FROM MYST_COUNTRY_BOUNDARIES b
GROUP BY b.STGEOM.ST_GEOMETRYTYPE();

3D.
SELECT b.CNTRY_NAME, b.STGEOM.ST_ISSIMPLE() 
FROM MYST_COUNTRY_BOUNDARIES b;

4A.
SELECT B.CNTRY_NAME, COUNT(*)
FROM MYST_COUNTRY_BOUNDARIES B, MYST_MAJOR_CITIES C
WHERE C.STGEOM.ST_WITHIN(B.STGEOM) = 1
GROUP BY B.CNTRY_NAME;

4B.
SELECT B.CNTRY_NAME, A.CNTRY_NAME
FROM MYST_COUNTRY_BOUNDARIES A, MYST_COUNTRY_BOUNDARIES B
WHERE A.CNTRY_NAME = 'Czech Republic'
  AND A.STGEOM.ST_TOUCHES(B.STGEOM) = 1;

4C.
SELECT DISTINCT B.CNTRY_NAME, R.NAME
FROM MYST_COUNTRY_BOUNDARIES B, RIVERS R
WHERE B.CNTRY_NAME = 'Czech Republic'
  AND ST_LINESTRING(R.GEOM).ST_INTERSECTS(B.STGEOM) = 1;

4D.
SELECT TREAT(a.STGEOM.ST_UNION(b.STGEOM) AS ST_SURFACE).ST_AREA() AS POWIERZCHNIA
FROM MYST_COUNTRY_BOUNDARIES a, MYST_COUNTRY_BOUNDARIES b
WHERE a.CNTRY_NAME = 'Czech Republic'
  AND b.CNTRY_NAME = 'Slovakia';

4E.
SELECT 
    TREAT(B.STGEOM.ST_DIFFERENCE(ST_GEOMETRY(W.GEOM)) AS ST_POLYGON).GET_SDO_GEOM() AS OBIEKT_STRUKTURA,
    TREAT(B.STGEOM.ST_DIFFERENCE(ST_GEOMETRY(W.GEOM)) AS ST_POLYGON).ST_GEOMETRYTYPE() AS TYP
FROM MYST_COUNTRY_BOUNDARIES B, WATER_BODIES W
WHERE B.CNTRY_NAME = 'Hungary'
  AND W.NAME = 'Balaton';

  sus

5A.
SELECT COUNT(*)
FROM MYST_MAJOR_CITIES C, MYST_COUNTRY_BOUNDARIES B
WHERE B.CNTRY_NAME = 'Poland'
  AND SDO_WITHIN_DISTANCE(C.STGEOM, B.STGEOM, 'distance=100 unit=km') = 'TRUE';
  

5B.

5C.

5D.


