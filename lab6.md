# LAB 21.11 - Oracle Spatial: Standard SQL/MM

## Zadanie 1A
```sql
select lpad('-',2*(level-1),'|-') || t.owner||'.'||t.type_name||' (FINAL:'||t.final|| 
', INSTANTIABLE:'||t.instantiable||', ATTRIBUTES:'||t.attributes||', METHODS:'||t.methods||')' 
from   all_types t 
start with t.type_name = 'ST_GEOMETRY' 
connect by prior t.type_name = t.supertype_name  
and prior t.owner = t.owner; 
```

## Zadanie 1B
```sql
select distinct m.method_name 
from   all_type_methods m 
where  m.type_name like 'ST_POLYGON' 
and    m.owner = 'MDSYS' 
order by 1;
```

## Zadanie 1C
```sql
CREATE TABLE MYST_MAJOR_CITIES (
    FIPS_CNTRY VARCHAR2(2),
    CITY_NAME VARCHAR2(40),
    STGEOM ST_POINT
);
```

## Zadanie 1D
```sql
INSERT INTO MYST_MAJOR_CITIES
SELECT FIPS_CNTRY, CITY_NAME, 
       TREAT(ST_POINT.FROM_SDO_GEOM(GEOM) AS ST_POINT)
FROM MAJOR_CITIES;
```

## Zadanie 2
```sql
INSERT INTO MYST_MAJOR_CITIES 
VALUES ('PL', 'Szczyrk', ST_POINT(19.036107, 49.718655, 8307));
```

## Zadanie 3A
```sql
CREATE TABLE MYST_COUNTRY_BOUNDARIES (
    FIPS_CNTRY VARCHAR2(2),
    CNTRY_NAME VARCHAR2(40),
    STGEOM ST_MULTIPOLYGON
);
```

## Zadanie 3B
```sql
INSERT INTO MYST_COUNTRY_BOUNDARIES
SELECT FIPS_CNTRY, CNTRY_NAME, ST_MULTIPOLYGON(GEOM)
FROM COUNTRY_BOUNDARIES;
```

## Zadanie 3C
```sql
SELECT b.STGEOM.ST_GEOMETRYTYPE() AS TYP, COUNT(*)
FROM MYST_COUNTRY_BOUNDARIES b
GROUP BY b.STGEOM.ST_GEOMETRYTYPE();
```

## Zadanie 3D
```sql
SELECT b.CNTRY_NAME, b.STGEOM.ST_ISSIMPLE() 
FROM MYST_COUNTRY_BOUNDARIES b;
```

## Zadanie 4A
```sql
SELECT B.CNTRY_NAME, COUNT(*)
FROM MYST_COUNTRY_BOUNDARIES B, MYST_MAJOR_CITIES C
WHERE C.STGEOM.ST_WITHIN(B.STGEOM) = 1
GROUP BY B.CNTRY_NAME;
```

## Zadanie 4B
```sql
SELECT B.CNTRY_NAME, A.CNTRY_NAME
FROM MYST_COUNTRY_BOUNDARIES A, MYST_COUNTRY_BOUNDARIES B
WHERE A.CNTRY_NAME = 'Czech Republic'
  AND A.STGEOM.ST_TOUCHES(B.STGEOM) = 1;
```

## Zadanie 4C
```sql
SELECT DISTINCT B.CNTRY_NAME, R.NAME
FROM MYST_COUNTRY_BOUNDARIES B, RIVERS R
WHERE B.CNTRY_NAME = 'Czech Republic'
  AND ST_LINESTRING(R.GEOM).ST_INTERSECTS(B.STGEOM) = 1;
```

## Zadanie 4D
```sql
SELECT TREAT(a.STGEOM.ST_UNION(b.STGEOM) AS ST_SURFACE).ST_AREA() AS POWIERZCHNIA
FROM MYST_COUNTRY_BOUNDARIES a, MYST_COUNTRY_BOUNDARIES b
WHERE a.CNTRY_NAME = 'Czech Republic'
  AND b.CNTRY_NAME = 'Slovakia';
```

## Zadanie 4E
```sql
SELECT 
    TREAT(B.STGEOM.ST_DIFFERENCE(ST_GEOMETRY(W.GEOM)) AS ST_POLYGON).GET_SDO_GEOM() AS OBIEKT_STRUKTURA,
    TREAT(B.STGEOM.ST_DIFFERENCE(ST_GEOMETRY(W.GEOM)) AS ST_POLYGON).ST_GEOMETRYTYPE() AS TYP
FROM MYST_COUNTRY_BOUNDARIES B, WATER_BODIES W
WHERE B.CNTRY_NAME = 'Hungary'
  AND W.NAME = 'Balaton';
```

## Zadanie 5A
```sql
SELECT COUNT(*)
FROM MYST_MAJOR_CITIES C, MYST_COUNTRY_BOUNDARIES B
WHERE B.CNTRY_NAME = 'Poland'
  AND SDO_WITHIN_DISTANCE(C.STGEOM, B.STGEOM, 'distance=100 unit=km') = 'TRUE';
```

## Zadanie 5B
```sql
INSERT INTO USER_SDO_GEOM_METADATA 
SELECT 'MYST_MAJOR_CITIES', 'STGEOM', T.DIMINFO, T.SRID
FROM ALL_SDO_GEOM_METADATA T
WHERE T.TABLE_NAME = 'MAJOR_CITIES';

INSERT INTO USER_SDO_GEOM_METADATA 
SELECT 'MYST_COUNTRY_BOUNDARIES', 'STGEOM', T.DIMINFO, T.SRID
FROM ALL_SDO_GEOM_METADATA T
WHERE T.TABLE_NAME = 'COUNTRY_BOUNDARIES';
```

## Zadanie 5C
```sql
CREATE INDEX MYST_MAJOR_CITIES_IDX 
ON MYST_MAJOR_CITIES(STGEOM) 
INDEXTYPE IS MDSYS.SPATIAL_INDEX;
```

## Zadanie 5D
```sql
EXPLAIN PLAN FOR
SELECT count(*)
FROM MYST_MAJOR_CITIES C, MYST_COUNTRY_BOUNDARIES B
WHERE B.CNTRY_NAME = 'Poland'
  AND SDO_WITHIN_DISTANCE(C.STGEOM, B.STGEOM, 'distance=100 unit=km') = 'TRUE';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
```