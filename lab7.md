# LAB 28.11 - Oracle Spatial: Uk≈Çady LRS

## Zadanie 1A
```sql
CREATE TABLE S6_LRS (
  GEOM MDSYS.SDO_GEOMETRY
);
```

## Zadanie 1B
```sql
INSERT INTO S6_LRS (GEOM)
SELECT SR.GEOM
FROM STREETS_AND_RAILROADS SR, MAJOR_CITIES C
WHERE C.CITY_NAME = 'Koszalin'
  AND SDO_WITHIN_DISTANCE(SR.GEOM, C.GEOM, 'distance=10 unit=km') = 'TRUE';
```

## Zadanie 1C
```sql
SELECT 
  SDO_GEOM.SDO_LENGTH(GEOM, 1, 'unit=km') AS DISTANCE,
  SDO_UTIL.GETNUMVERTICES(GEOM) AS ST_NUMPOINTS
FROM S6_LRS;
```

## Zadanie 1D
```sql
UPDATE S6_LRS
SET GEOM = SDO_LRS.CONVERT_TO_LRS_GEOM(GEOM, 0, 276.6813154);
```

## Zadanie 1E
```sql
INSERT INTO USER_SDO_GEOM_METADATA
VALUES (
  'S6_LRS',
  'GEOM',
  MDSYS.SDO_DIM_ARRAY(
    MDSYS.SDO_DIM_ELEMENT('X', 12, 26, 1),   
    MDSYS.SDO_DIM_ELEMENT('Y', 45, 58, 1),   
    MDSYS.SDO_DIM_ELEMENT('M', 0, 300, 1)    
  ),
  8307
);
```

## Zadanie 1F
```sql
CREATE INDEX S6_LRS_IDX ON S6_LRS(GEOM)
INDEXTYPE IS MDSYS.SPATIAL_INDEX;
```

## Zadanie 2A
```sql
SELECT SDO_LRS.VALID_MEASURE(GEOM, 500) AS VALID_500
FROM S6_LRS;
```

## Zadanie 2B
```sql
SELECT SDO_LRS.GEOM_SEGMENT_END_PT(GEOM) AS END_PT
FROM S6_LRS;
```

## Zadanie 2C
```sql
SELECT SDO_LRS.LOCATE_PT(GEOM, 150, 0) AS KM150
FROM S6_LRS;
```

## Zadanie 2D
```sql
SELECT SDO_LRS.CLIP_GEOM_SEGMENT(GEOM, 120, 160) AS CLIPPED
FROM S6_LRS;
```

## Zadanie 2E
```sql
SELECT 
  MDSYS.SDO_GEOMETRY(3301, 8307, NULL, 
      MDSYS.SDO_ELEM_INFO_ARRAY(1,1,1), 
      MDSYS.SDO_ORDINATE_ARRAY(t.X, t.Y, t.Z)) AS WJAZD_NA_S6
FROM 
  S6_LRS s, 
  MAJOR_CITIES c,
  TABLE(SDO_UTIL.GETVERTICES(s.GEOM)) t
WHERE 
  c.CITY_NAME = 'Slupsk'
ORDER BY 
  SDO_GEOM.SDO_DISTANCE(
      MDSYS.SDO_GEOMETRY(2001, 8307, NULL, MDSYS.SDO_ELEM_INFO_ARRAY(1,1,1), MDSYS.SDO_ORDINATE_ARRAY(t.X, t.Y)),
      c.GEOM, 
      1, 
      'unit=km'
  ) ASC
FETCH FIRST 1 ROWS ONLY;
```

## Zadanie 2F
```sql
SELECT 
  SDO_GEOM.SDO_LENGTH(
    SDO_LRS.OFFSET_GEOM_SEGMENT(
      S6.GEOM, 
      M.DIMINFO, 
      50,   
      200,  
      50,   
      'unit=m arc_tolerance=1'
    ), 
    1, 'unit=km'
  ) * 1 AS KOSZT
FROM S6_LRS S6, USER_SDO_GEOM_METADATA M
WHERE M.TABLE_NAME = 'S6_LRS' AND M.COLUMN_NAME = 'GEOM';
```